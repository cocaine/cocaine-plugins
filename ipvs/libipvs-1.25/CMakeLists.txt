ADD_LIBRARY(ipvs STATIC
    libipvs
    ip_vs_nl_policy)

SET_TARGET_PROPERTIES(ipvs PROPERTIES
    COMPILE_FLAGS "-fpic")
    
# find libnl
FIND_PATH(LIBNL_INCLUDE_DIRS NAMES "netlink/netlink.h" PATH_SUFFIXES ${ARGN})
FIND_LIBRARY(LIBNL_LIBRARIES NAMES "nl" PATH_SUFFIXES ${ARGN})
GET_FILENAME_COMPONENT(LIBNL_LIBRARY_DIRS ${LIBNL_LIBRARIES} PATH CACHE)

IF(LIBNL_INCLUDE_DIRS AND LIBNL_LIBRARY_DIRS)
    MESSAGE(STATUS "Found libnl: ${LIBNL_LIBRARIES}")

    ADD_DEFINITIONS("-DLIBIPVS_USE_NL")
    
    INCLUDE_DIRECTORIES(${LIBNL_INCLUDE_DIRS})
    LINK_DIRECTORIES(${LIBNL_LIBRARY_DIRS})
    
    TARGET_LINK_LIBRARIES(ipvs nl)
ELSE()
    MESSAGE(STATUS "libnl not found. Build without netlink support.")
ENDIF()
